<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Indian Election Commission - Online Voting System</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Tailwind CSS CDN for modern styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css?family=Poppins:400,600,700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: url('https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=1500&q=80') center/cover no-repeat fixed, linear-gradient(120deg, #0f172a 0%, #312e81 100%);
            min-height: 100vh;
            /* Add a subtle animated overlay */
            position: relative;
        }
        body::before {
            content: "";
            position: fixed;
            inset: 0;
            z-index: 0;
            pointer-events: none;
            background: radial-gradient(ellipse at 60% 40%, rgba(99,102,241,0.15) 0%, transparent 70%),
                        radial-gradient(ellipse at 20% 80%, rgba(16,185,129,0.10) 0%, transparent 80%);
            animation: bgmove 12s linear infinite alternate;
        }
        @keyframes bgmove {
            0% { background-position: 60% 40%, 20% 80%; }
            100% { background-position: 65% 45%, 25% 85%; }
        }
        .overlay {
            background: rgba(255,255,255,0.85);
            backdrop-filter: blur(8px);
            position: relative;
            z-index: 1;
        }
        .card {
            background: rgba(255,255,255,0.85);
            backdrop-filter: blur(12px);
            box-shadow: 0 6px 32px rgba(59,130,246,0.18), 0 1.5px 6px rgba(0,0,0,0.08);
            transition: transform 0.18s cubic-bezier(.4,2,.6,1), box-shadow 0.18s;
            position: relative;
            overflow: hidden;
        }
        .card::before {
            content: "";
            position: absolute;
            top: -60%;
            left: -60%;
            width: 220%;
            height: 220%;
            background: conic-gradient(from 90deg, #6366f1 0%, #06b6d4 30%, #a21caf 60%, #6366f1 100%);
            opacity: 0.13;
            filter: blur(24px);
            z-index: 0;
            animation: sifiGlow 6s linear infinite alternate;
        }
        @keyframes sifiGlow {
            0% { transform: rotate(0deg) scale(1); }
            100% { transform: rotate(360deg) scale(1.1);}
        }
        .card > * { position: relative; z-index: 1; }
        .card:hover {
            transform: translateY(-6px) scale(1.035) rotate(-1deg);
            box-shadow: 0 16px 48px 0 rgba(59,130,246,0.22), 0 2px 8px rgba(0,0,0,0.10);
        }
        .animated-card {
            animation: fadeIn 0.7s cubic-bezier(.4,2,.6,1) forwards, floatCard 3s ease-in-out infinite alternate;
            opacity: 0;
            transform: translateY(24px) scale(0.97);
        }
        .animated-card.visible {
            opacity: 1;
            transform: translateY(0) scale(1);
        }
        @keyframes fadeIn {
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        @keyframes floatCard {
            0% { box-shadow: 0 6px 32px rgba(59,130,246,0.18); transform: translateY(0) scale(1);}
            100% { box-shadow: 0 12px 40px rgba(99,102,241,0.22); transform: translateY(-8px) scale(1.02);}
        }
        .tagline {
            animation: taglineFade 2s ease-in-out infinite alternate, glowText 3s ease-in-out infinite alternate;
        }
        @keyframes taglineFade {
            from { color: #6366f1; }
            to { color: #f59e42; }
        }
        @keyframes glowText {
            0% { text-shadow: 0 0 8px #6366f1, 0 0 2px #fff; }
            100% { text-shadow: 0 0 18px #f59e42, 0 0 8px #fff; }
        }
        /* Sifi button effect */
        .sifi-btn {
            position: relative;
            overflow: hidden;
            z-index: 1;
        }
        .sifi-btn::before {
            content: "";
            position: absolute;
            left: -50%;
            top: -50%;
            width: 200%;
            height: 200%;
            background: conic-gradient(from 0deg, #6366f1, #06b6d4, #a21caf, #6366f1 100%);
            opacity: 0.18;
            filter: blur(18px);
            z-index: 0;
            transition: opacity 0.3s;
            animation: sifiBtnGlow 5s linear infinite;
        }
        .sifi-btn:hover::before {
            opacity: 0.32;
        }
        @keyframes sifiBtnGlow {
            0% { transform: rotate(0deg);}
            100% { transform: rotate(360deg);}
        }
        .sifi-btn > * { position: relative; z-index: 1; }
    </style>
</head>
<body>
    <!-- Header / Navbar -->
    <header class="bg-white/90 backdrop-blur-lg shadow-lg sticky top-0 z-50">
        <div class="container mx-auto flex justify-between items-center py-4 px-6">
            <div class="flex items-center gap-3">
                <img src="https://upload.wikimedia.org/wikipedia/commons/4/41/Emblem_of_India.svg" alt="India Emblem" class="w-10 h-10">
                <span class="text-2xl font-bold text-blue-700 tracking-wide">Election Commission of India</span>
            </div>
            <nav class="flex gap-6">
                <a href="#" class="text-gray-700 hover:text-blue-600 font-semibold" id="navHome">Home</a>
                <a href="#" class="text-gray-700 hover:text-blue-600 font-semibold" id="navVoterLogin">Voter Login</a>
                <a href="#" class="text-gray-700 hover:text-blue-600 font-semibold" id="navVote">Vote</a>
                <a href="#" class="text-gray-700 hover:text-blue-600 font-semibold" id="navResults">Results</a>
                <a href="#" class="text-gray-700 hover:text-blue-600 font-semibold" id="navAdmin">Admin</a>
            </nav>
        </div>
    </header>

    <main class="container mx-auto px-4 py-8">
        <!-- Home Page -->
        <div id="homePage">
            <section class="py-12 overlay rounded-2xl shadow-xl">
                <div class="max-w-4xl mx-auto text-center">
                    <h2 class="text-4xl md:text-5xl font-extrabold text-gray-800 mb-4 tracking-tight drop-shadow-lg">Welcome to the Indian Election Commission Voting Portal</h2>
                    <p class="tagline text-xl md:text-2xl font-semibold mb-6">"Your Vote, Your Voice, Your India"</p>
                    <p class="text-lg md:text-xl text-gray-600 mb-10">Vote for your favorite party and help shape the future of India. Secure, transparent, and easy to use.</p>
                    <div class="grid md:grid-cols-3 gap-8">
                        <div class="card p-8 rounded-2xl shadow-2xl animated-card">
                            <div class="flex items-center justify-center mb-5">
                                <div class="w-20 h-20 rounded-full bg-gradient-to-tr from-blue-500 to-indigo-500 flex items-center justify-center shadow-lg">
                                    <img src="https://placehold.co/60x60/3b82f6/FFF?text=âœ“" alt="Voting icon" class="w-12 h-12">
                                </div>
                            </div>
                            <h3 class="text-2xl font-semibold mb-3 text-blue-700">Cast Your Vote</h3>
                            <p class="text-gray-600">Vote securely for your preferred party. Your vote is confidential and protected.</p>
                        </div>
                        <div class="card p-8 rounded-2xl shadow-2xl animated-card">
                            <div class="flex items-center justify-center mb-5">
                                <div class="w-20 h-20 rounded-full bg-gradient-to-tr from-orange-500 to-yellow-400 flex items-center justify-center shadow-lg">
                                    <img src="https://placehold.co/60x60/f97316/FFF?text=ðŸ‘¥" alt="Candidate registration icon" class="w-12 h-12">
                                </div>
                            </div>
                            <h3 class="text-2xl font-semibold mb-3 text-orange-600">Transparent Process</h3>
                            <p class="text-gray-600">Every vote is counted. See real-time results and analytics.</p>
                        </div>
                        <div class="card p-8 rounded-2xl shadow-2xl animated-card">
                            <div class="flex items-center justify-center mb-5">
                                <div class="w-20 h-20 rounded-full bg-gradient-to-tr from-indigo-500 to-blue-400 flex items-center justify-center shadow-lg">
                                    <img src="https://placehold.co/60x60/4f46e5/FFF?text=ðŸ“Š" alt="Bar chart" class="w-12 h-12">
                                </div>
                            </div>
                            <h3 class="text-2xl font-semibold mb-3 text-indigo-700">Live Results</h3>
                            <p class="text-gray-600">Track the election results as votes are counted live.</p>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- Voter Login Page -->
        <div id="voterLoginPage" class="hidden min-h-screen flex items-center justify-center">
            <div class="card p-10 rounded-2xl shadow-2xl max-w-md w-full bg-white/90 backdrop-blur-lg border border-blue-100 animated-card">
                <div class="flex flex-col items-center mb-8">
                    <img src="https://placehold.co/64x64/3b82f6/FFF?text=ðŸ—³ï¸" alt="Voter icon" class="w-16 h-16 rounded-full shadow-lg mb-4">
                    <h2 class="text-3xl font-extrabold text-blue-700 mb-2 tracking-tight">Voter Login</h2>
                    <p class="text-gray-500 text-center">Enter your Voter ID to access the voting system.</p>
                </div>
                <form id="voterLoginForm" autocomplete="off">
                    <div class="mb-6">
                        <label class="block text-gray-700 mb-2" for="loginVoterId">Voter ID</label>
                        <input type="text" id="loginVoterId" class="w-full px-4 py-3 border border-blue-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 bg-white/80" placeholder="Enter your Voter ID" required>
                    </div>
                    <button type="submit" class="sifi-btn w-full bg-gradient-to-r from-blue-500 to-indigo-500 text-white py-3 rounded-lg font-semibold text-lg shadow-md hover:from-indigo-500 hover:to-blue-500 transition">Login as Voter</button>
                </form>
                <div class="mt-6 text-center">
                    <a href="#" id="backToHomeFromVoter" class="text-blue-600 hover:underline text-sm">Back to Home</a>
                </div>
            </div>
        </div>

        <!-- Voting Page -->
        <div id="votePage" class="hidden">
            <section class="max-w-xl mx-auto bg-white/90 rounded-2xl shadow-xl p-8 mt-10 overlay">
                <h2 class="text-3xl font-bold text-blue-700 mb-2 text-center">Vote for Your Party</h2>
                <p class="text-center text-lg text-gray-500 mb-6 tagline">"Every Vote Counts. Make Yours Matter."</p>
                <form id="voteForm" class="space-y-6">
                    <div>
                        <label class="block text-gray-700 mb-2" for="voterId">Voter ID</label>
                        <input type="text" id="voterId" class="w-full px-4 py-3 border border-blue-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 bg-white/80" placeholder="Enter your Voter ID" required readonly>
                    </div>
                    <div>
                        <label class="block text-gray-700 mb-2" for="party">Select Party</label>
                        <select id="party" class="w-full px-4 py-3 border border-blue-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 bg-white/80" required>
                            <option value="">-- Choose Party --</option>
                        </select>
                    </div>
                    <button type="submit" class="sifi-btn w-full bg-gradient-to-r from-blue-500 to-indigo-500 text-white py-3 rounded-lg font-semibold text-lg shadow-md hover:from-indigo-500 hover:to-blue-500 transition animate-bounce">Submit Vote</button>
                </form>
                <div id="voteMessage" class="mt-6 text-center text-lg font-semibold"></div>
            </section>
        </div>

        <!-- Results Page -->
        <div id="resultsPage" class="hidden">
            <section class="max-w-3xl mx-auto bg-white/90 rounded-2xl shadow-2xl p-8 mt-10 overlay relative overflow-hidden">
                <!-- Animated background for sci-fi effect -->
                <div class="absolute inset-0 pointer-events-none z-0">
                    <div class="absolute w-72 h-72 bg-gradient-to-tr from-indigo-400 via-blue-400 to-transparent rounded-full blur-3xl opacity-30 animate-pulse -top-24 -left-24"></div>
                    <div class="absolute w-56 h-56 bg-gradient-to-tr from-blue-400 via-indigo-400 to-transparent rounded-full blur-2xl opacity-20 animate-pulse -bottom-20 -right-20"></div>
                </div>
                <div class="relative z-10">
                    <div class="flex flex-col md:flex-row md:justify-between items-center mb-4">
                        <div class="flex items-center gap-2">
                            <span class="inline-block w-3 h-3 rounded-full bg-green-500 animate-pulse"></span>
                            <span class="text-green-700 font-semibold">Live Counting</span>
                        </div>
                        <div class="text-indigo-700 font-mono text-lg" id="liveClock"></div>
                    </div>
                    <h2 class="text-4xl font-extrabold text-indigo-700 mb-2 text-center drop-shadow-lg">Live Election Results</h2>
                    <p class="text-center text-lg text-gray-500 mb-6 tagline">"Transparency in Every Count"</p>
                    <div class="flex flex-col md:flex-row md:justify-between items-center mb-8 gap-4">
                        <div class="bg-gradient-to-r from-blue-100 to-indigo-100 rounded-xl px-6 py-4 shadow-lg flex flex-col items-center w-full md:w-1/3">
                            <span class="text-2xl font-bold text-blue-700">Total Votes</span>
                            <span id="totalVotesStat" class="text-4xl font-extrabold text-indigo-800 mt-2 tracking-widest count-up">0</span>
                        </div>
                        <div class="bg-gradient-to-r from-indigo-100 to-blue-100 rounded-xl px-6 py-4 shadow-lg flex flex-col items-center w-full md:w-1/3">
                            <span class="text-2xl font-bold text-indigo-700">Parties</span>
                            <span id="totalPartiesStat" class="text-4xl font-extrabold text-blue-800 mt-2 tracking-widest count-up">0</span>
                        </div>
                        <div class="bg-gradient-to-r from-blue-100 to-indigo-100 rounded-xl px-6 py-4 shadow-lg flex flex-col items-center w-full md:w-1/3">
                            <span class="text-2xl font-bold text-blue-700">Last Vote</span>
                            <span id="lastVoteStat" class="text-lg font-semibold text-indigo-700 mt-2 truncate">-</span>
                        </div>
                    </div>
                    <div class="flex flex-col md:flex-row gap-8 items-center justify-center mb-8">
                        <div class="w-full md:w-1/2 flex justify-center">
                            <canvas id="votesPieChart" width="260" height="260"></canvas>
                        </div>
                        <div class="w-full md:w-1/2">
                            <div id="resultsList" class="space-y-6"></div>
                        </div>
                    </div>
                    <!-- Add this below your stats cards in #resultsPage -->
                    <div class="w-full my-6">
                        <div class="flex justify-between text-xs text-gray-500 mb-1">
                            <span>0</span>
                            <span id="votesGoalLabel">Goal: 1000</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-3">
                            <div id="votesGoalBar" class="bg-gradient-to-r from-green-400 to-blue-500 h-3 rounded-full transition-all duration-700" style="width:0%"></div>
                        </div>
                    </div>
                    <!-- Add this below your pie chart in #resultsPage -->
                    <div class="flex justify-center mt-4">
                        <button id="shareResultsBtn" class="sifi-btn bg-gradient-to-r from-indigo-500 to-blue-500 text-white px-6 py-2 rounded-lg font-semibold shadow-md hover:from-blue-500 hover:to-indigo-500 transition">
                            Share Results
                        </button>
                    </div>
                </div>
            </section>
        </div>

        <!-- Admin Login Page -->
        <div id="adminLoginPage" class="hidden min-h-screen flex items-center justify-center">
            <div class="card p-10 rounded-2xl shadow-2xl max-w-md w-full bg-white/90 backdrop-blur-lg border border-indigo-100 animated-card">
                <div class="flex flex-col items-center mb-8">
                    <img src="https://placehold.co/64x64/6366f1/FFF?text=ðŸ”’" alt="Admin lock icon" class="w-16 h-16 rounded-full shadow-lg mb-4">
                    <h2 class="text-3xl font-extrabold text-indigo-700 mb-2 tracking-tight">Admin Login</h2>
                    <p class="text-gray-500 text-center">Restricted access. Only authorized election administrators may proceed.</p>
                </div>
                <form id="adminLoginForm" autocomplete="off">
                    <div class="mb-5">
                        <label class="block text-gray-700 mb-2" for="adminUsername">Username</label>
                        <input type="text" id="adminUsername" class="w-full px-4 py-3 border border-indigo-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-400 bg-white/80" placeholder="Enter admin username" required>
                    </div>
                    <div class="mb-6">
                        <label class="block text-gray-700 mb-2" for="adminPassword">Password</label>
                        <input type="password" id="adminPassword" class="w-full px-4 py-3 border border-indigo-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-400 bg-white/80" placeholder="Enter password" required>
                    </div>
                    <button type="submit" class="sifi-btn w-full bg-gradient-to-r from-indigo-500 to-blue-500 text-white py-3 rounded-lg font-semibold text-lg shadow-md hover:from-blue-500 hover:to-indigo-500 transition">Login as Admin</button>
                </form>
                <div class="mt-6 text-center">
                    <a href="#" id="backToHomeFromAdmin" class="text-indigo-600 hover:underline text-sm">Back to Home</a>
                </div>
            </div>
        </div>

        <!-- Admin Dashboard Page -->
        <div id="adminPage" class="hidden">
            <section class="max-w-2xl mx-auto bg-white/90 rounded-2xl shadow-2xl p-8 mt-10 overlay">
                <h2 class="text-3xl font-bold text-indigo-700 mb-6 text-center">Admin Dashboard</h2>
                <div class="mb-8">
                    <h3 class="text-xl font-semibold mb-2">Registered Parties</h3>
                    <ul id="adminPartyList" class="list-disc list-inside text-gray-700"></ul>
                </div>
                <div>
                    <h3 class="text-xl font-semibold mb-2">Add New Party</h3>
                    <form id="addPartyForm" class="flex gap-3">
                        <input type="text" id="newPartyName" class="flex-1 px-4 py-2 border border-indigo-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-400 bg-white/80" placeholder="Party Name" required>
                        <button type="submit" class="bg-gradient-to-r from-indigo-500 to-blue-500 text-white px-6 py-2 rounded-lg font-semibold shadow-md hover:from-blue-500 hover:to-indigo-500 transition">Add</button>
                    </form>
                </div>
                <div class="mt-8 text-center">
                    <button id="adminLogout" class="text-indigo-600 hover:underline text-sm">Logout</button>
                </div>
            </section>
        </div>

        <!-- Voter Registration Page -->
        <div id="voterRegisterPage" class="hidden min-h-screen flex items-center justify-center">
            <div class="card p-10 rounded-2xl shadow-2xl max-w-md w-full bg-white/90 backdrop-blur-lg border border-blue-100 animated-card">
                <div class="flex flex-col items-center mb-8">
                    <img src="https://placehold.co/64x64/3b82f6/FFF?text=ðŸ“" alt="Voter registration icon" class="w-16 h-16 rounded-full shadow-lg mb-4">
                    <h2 class="text-3xl font-extrabold text-blue-700 mb-2 tracking-tight">Voter Registration</h2>
                    <p class="text-gray-500 text-center">Register to get your Voter ID and participate in the election.</p>
                </div>
                <form id="voterRegisterForm" autocomplete="off">
                    <div class="mb-5">
                        <label class="block text-gray-700 mb-2" for="registerVoterName">Full Name</label>
                        <input type="text" id="registerVoterName" class="w-full px-4 py-3 border border-blue-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 bg-white/80" placeholder="Enter your name" required>
                    </div>
                    <div class="mb-6">
                        <label class="block text-gray-700 mb-2" for="registerVoterId">Voter ID</label>
                        <input type="text" id="registerVoterId" class="w-full px-4 py-3 border border-blue-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 bg-white/80" placeholder="Create a Voter ID" required>
                    </div>
                    <button type="submit" class="sifi-btn w-full bg-gradient-to-r from-blue-500 to-indigo-500 text-white py-3 rounded-lg font-semibold text-lg shadow-md hover:from-indigo-500 hover:to-blue-500 transition">Register</button>
                </form>
                <div class="mt-6 text-center">
                    <a href="#" id="backToLoginFromVoterReg" class="text-blue-600 hover:underline text-sm">Back to Login</a>
                </div>
                <div id="voterRegisterMsg" class="mt-4 text-center text-base font-semibold"></div>
            </div>
        </div>

        <!-- Admin Registration Page -->
        <div id="adminRegisterPage" class="hidden min-h-screen flex items-center justify-center">
            <div class="card p-10 rounded-2xl shadow-2xl max-w-md w-full bg-white/90 backdrop-blur-lg border border-indigo-100 animated-card">
                <div class="flex flex-col items-center mb-8">
                    <img src="https://placehold.co/64x64/6366f1/FFF?text=ðŸ›¡ï¸" alt="Admin registration icon" class="w-16 h-16 rounded-full shadow-lg mb-4">
                    <h2 class="text-3xl font-extrabold text-indigo-700 mb-2 tracking-tight">Admin Registration</h2>
                    <p class="text-gray-500 text-center">Register as an election administrator.</p>
                </div>
                <form id="adminRegisterForm" autocomplete="off">
                    <div class="mb-5">
                        <label class="block text-gray-700 mb-2" for="registerAdminUsername">Username</label>
                        <input type="text" id="registerAdminUsername" class="w-full px-4 py-3 border border-indigo-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-400 bg-white/80" placeholder="Create a username" required>
                    </div>
                    <div class="mb-6">
                        <label class="block text-gray-700 mb-2" for="registerAdminPassword">Password</label>
                        <input type="password" id="registerAdminPassword" class="w-full px-4 py-3 border border-indigo-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-400 bg-white/80" placeholder="Create a password" required>
                    </div>
                    <button type="submit" class="sifi-btn w-full bg-gradient-to-r from-indigo-500 to-blue-500 text-white py-3 rounded-lg font-semibold text-lg shadow-md hover:from-blue-500 hover:to-indigo-500 transition">Register</button>
                </form>
                <div class="mt-6 text-center">
                    <a href="#" id="backToLoginFromAdminReg" class="text-indigo-600 hover:underline text-sm">Back to Login</a>
                </div>
                <div id="adminRegisterMsg" class="mt-4 text-center text-base font-semibold"></div>
            </div>
        </div>
    </main>

    <footer class="bg-gradient-to-r from-blue-900 to-indigo-800 text-white py-6 mt-16">
        <div class="container mx-auto text-center text-sm">
            &copy; 2025 Election Commission of India. All rights reserved.
        </div>
    </footer>

    <script>
let votesPieChart = null;

// Demo parties
let parties = [
    { name: "Bharatiya Janata Party (BJP)", votes: 0 },
    { name: "Indian National Congress (INC)", votes: 0 },
    { name: "Aam Aadmi Party (AAP)", votes: 0 },
    { name: "Bahujan Samaj Party (BSP)", votes: 0 },
    { name: "Communist Party of India (CPI)", votes: 0 }
];
let votes = {}; // voterId: partyName
let adminLoggedIn = false;
let currentVoterId = null;

// In-memory storage for demo (replace with backend for real use)
let registeredVoters = {}; // voterId: { name }
let registeredAdmins = { "admin": "india2024" }; // username: password

// Utility: Animate numbers
function animateCountUp(element, end) {
    let start = parseInt(element.textContent.replace(/\D/g, "")) || 0;
    end = parseInt(end);
    if (start === end) return;
    let duration = 800;
    let startTime = null;
    function animateStep(timestamp) {
        if (!startTime) startTime = timestamp;
        let progress = Math.min((timestamp - startTime) / duration, 1);
        let value = Math.floor(progress * (end - start) + start);
        element.textContent = value;
        if (progress < 1) {
            requestAnimationFrame(animateStep);
        } else {
            element.textContent = end;
        }
    }
    requestAnimationFrame(animateStep);
}

// Navigation
function showPage(pageId) {
    ['homePage', 'voterLoginPage', 'votePage', 'resultsPage', 'adminLoginPage', 'adminPage', 'voterRegisterPage', 'adminRegisterPage'].forEach(id => {
        const el = document.getElementById(id);
        if (el) el.classList.add('hidden');
    });
    const showEl = document.getElementById(pageId);
    if (showEl) showEl.classList.remove('hidden');
    // If showing results, render them
    if (pageId === 'resultsPage') renderResults();
}
document.getElementById('navHome').onclick = () => showPage('homePage');
document.getElementById('navVoterLogin').onclick = () => showPage('voterLoginPage');
document.getElementById('navVote').onclick = () => {
    if (currentVoterId) {
        document.getElementById('voterId').value = currentVoterId;
        showPage('votePage');
    } else {
        showPage('voterLoginPage');
    }
};
document.getElementById('navResults').onclick = () => showPage('resultsPage');
document.getElementById('navAdmin').onclick = () => showPage('adminLoginPage');
document.getElementById('backToHomeFromAdmin').onclick = (e) => { e.preventDefault(); showPage('homePage'); };
document.getElementById('backToHomeFromVoter').onclick = (e) => { e.preventDefault(); showPage('homePage'); };

// Registration links
document.getElementById('voterLoginForm').insertAdjacentHTML('afterend',
    `<div class="mt-4 text-center">
        <a href="#" id="showVoterRegister" class="text-blue-600 hover:underline text-sm">New user? Register here</a>
    </div>`
);
document.getElementById('adminLoginForm').insertAdjacentHTML('afterend',
    `<div class="mt-4 text-center">
        <a href="#" id="showAdminRegister" class="text-indigo-600 hover:underline text-sm">New admin? Register here</a>
    </div>`
);
document.getElementById('showVoterRegister').onclick = (e) => { e.preventDefault(); showPage('voterRegisterPage'); };
document.getElementById('backToLoginFromVoterReg').onclick = (e) => { e.preventDefault(); showPage('voterLoginPage'); };
document.getElementById('showAdminRegister').onclick = (e) => { e.preventDefault(); showPage('adminRegisterPage'); };
document.getElementById('backToLoginFromAdminReg').onclick = (e) => { e.preventDefault(); showPage('adminLoginPage'); };

// Voter Registration
document.getElementById('voterRegisterForm').onsubmit = function(e) {
    e.preventDefault();
    const name = document.getElementById('registerVoterName').value.trim();
    const voterId = document.getElementById('registerVoterId').value.trim();
    const msg = document.getElementById('voterRegisterMsg');
    if (!name || !voterId) {
        msg.textContent = "Please fill all fields.";
        msg.className = "mt-4 text-center text-base font-semibold text-red-600";
        return;
    }
    if (registeredVoters[voterId]) {
        msg.textContent = "Voter ID already registered.";
        msg.className = "mt-4 text-center text-base font-semibold text-orange-600";
        return;
    }
    registeredVoters[voterId] = { name };
    msg.textContent = "Registration successful! You can now login.";
    msg.className = "mt-4 text-center text-base font-semibold text-green-600";
    setTimeout(() => { msg.textContent = ""; showPage('voterLoginPage'); }, 2000);
    this.reset();
};

// Admin Registration
document.getElementById('adminRegisterForm').onsubmit = function(e) {
    e.preventDefault();
    const username = document.getElementById('registerAdminUsername').value.trim();
    const password = document.getElementById('registerAdminPassword').value.trim();
    const msg = document.getElementById('adminRegisterMsg');
    if (!username || !password) {
        msg.textContent = "Please fill all fields.";
        msg.className = "mt-4 text-center text-base font-semibold text-red-600";
        return;
    }
    if (registeredAdmins[username]) {
        msg.textContent = "Admin username already exists.";
        msg.className = "mt-4 text-center text-base font-semibold text-orange-600";
        return;
    }
    registeredAdmins[username] = password;
    msg.textContent = "Admin registered! You can now login.";
    msg.className = "mt-4 text-center text-base font-semibold text-green-600";
    setTimeout(() => { msg.textContent = ""; showPage('adminLoginPage'); }, 2000);
    this.reset();
};

// Voter Login
document.getElementById('voterLoginForm').onsubmit = function(e) {
    e.preventDefault();
    const voterId = document.getElementById('loginVoterId').value.trim();
    if (!voterId) return;
    if (!registeredVoters[voterId]) {
        alert("Voter ID not registered. Please register first.");
        return;
    }
    currentVoterId = voterId;
    document.getElementById('voterId').value = voterId;
    showPage('votePage');
    this.reset();
};

// Admin Login
document.getElementById('adminLoginForm').onsubmit = function(e) {
    e.preventDefault();
    const username = document.getElementById('adminUsername').value.trim();
    const password = document.getElementById('adminPassword').value.trim();
    if (registeredAdmins[username] && registeredAdmins[username] === password) {
        adminLoggedIn = true;
        showPage('adminPage');
        renderAdminParties();
    } else {
        alert("Invalid admin credentials.");
    }
    this.reset();
};
document.getElementById('adminLogout').onclick = function() {
    adminLoggedIn = false;
    showPage('homePage');
};

// Admin Party Management
function renderAdminParties() {
    const ul = document.getElementById('adminPartyList');
    ul.innerHTML = '';
    parties.forEach((p, i) => {
        ul.innerHTML += `<li class="flex justify-between items-center mb-2">
            <span>${p.name}</span>
            <button onclick="removeParty(${i})" class="ml-4 text-red-600 hover:underline text-xs">Remove</button>
        </li>`;
    });
}
window.removeParty = function(idx) {
    parties.splice(idx, 1);
    renderPartyOptions();
    renderAdminParties();
    renderResults();
};
document.getElementById('addPartyForm').onsubmit = function(e) {
    e.preventDefault();
    const name = document.getElementById('newPartyName').value.trim();
    if (name && !parties.some(p => p.name === name)) {
        parties.push({ name, votes: 0 });
        renderPartyOptions();
        renderAdminParties();
        renderResults();
    }
    this.reset();
};

// Voting
function renderPartyOptions() {
    const partySelect = document.getElementById('party');
    partySelect.innerHTML = '<option value="">-- Choose Party --</option>';
    parties.forEach(p => {
        const opt = document.createElement('option');
        opt.value = p.name;
        opt.textContent = p.name;
        partySelect.appendChild(opt);
    });
}
document.getElementById('voteForm').onsubmit = function(e) {
    e.preventDefault();
    const voterId = document.getElementById('voterId').value.trim();
    const party = document.getElementById('party').value;
    const msg = document.getElementById('voteMessage');
    if (!voterId || !party) {
        msg.textContent = "Please enter your Voter ID and select a party.";
        msg.className = "mt-6 text-center text-lg font-semibold text-red-600";
        return;
    }
    if (votes[voterId]) {
        msg.textContent = "You have already voted!";
        msg.className = "mt-6 text-center text-lg font-semibold text-orange-600";
        return;
    }
    votes[voterId] = party;
    parties.find(p => p.name === party).votes++;
    msg.textContent = "Thank you for voting!";
    msg.className = "mt-6 text-center text-lg font-semibold text-green-600";
    confettiBurst();
    renderResults();
    setTimeout(() => { msg.textContent = ""; }, 4000);
    this.reset();
    currentVoterId = null;
    setTimeout(() => showPage('homePage'), 2000);
};

// Results
function renderResults() {
    const resultsList = document.getElementById('resultsList');
    const totalVotesStat = document.getElementById('totalVotesStat');
    const totalPartiesStat = document.getElementById('totalPartiesStat');
    const lastVoteStat = document.getElementById('lastVoteStat');

    let totalVotes = parties.reduce((sum, p) => sum + p.votes, 0);
    let lastVoter = Object.keys(votes).length ? Object.keys(votes)[Object.keys(votes).length - 1] : null;
    let lastParty = lastVoter ? votes[lastVoter] : null;

    // Animate total votes count up
    animateCountUp(totalVotesStat, totalVotes);
    animateCountUp(totalPartiesStat, parties.length);

    lastVoteStat.textContent = lastVoter ? `Voter ID: ${lastVoter} â†’ ${lastParty}` : "-";

    // Sort parties by votes descending for realism
    let sortedParties = [...parties].sort((a, b) => b.votes - a.votes);

    resultsList.innerHTML = '';
    sortedParties.forEach((p, idx) => {
        let percent = totalVotes ? ((p.votes / totalVotes) * 100).toFixed(1) : 0;
        resultsList.innerHTML += `
            <div class="relative bg-gradient-to-r from-blue-50 via-indigo-50 to-white rounded-xl p-6 flex flex-col md:flex-row md:items-center justify-between shadow-lg animated-card" style="animation-delay:${idx * 0.15}s">
                <div class="flex items-center gap-4 mb-4 md:mb-0">
                    <div class="w-12 h-12 rounded-full bg-gradient-to-tr from-indigo-400 to-blue-400 flex items-center justify-center shadow-lg border-2 border-indigo-200">
                        <span class="text-2xl font-bold text-white">${p.name.match(/\((.*?)\)/) ? p.name.match(/\((.*?)\)/)[1][0] : p.name[0]}</span>
                    </div>
                    <span class="font-semibold text-lg text-blue-900">${p.name}</span>
                </div>
                <div class="flex-1 mx-4">
                    <div class="w-full bg-blue-100 rounded-full h-5 overflow-hidden shadow-inner">
                        <div class="bg-gradient-to-r from-blue-500 to-indigo-500 h-5 rounded-full result-bar" style="width:0%"></div>
                    </div>
                </div>
                <div class="flex flex-col items-end min-w-[120px]">
                    <span class="font-bold text-blue-700 text-xl count-up" data-count="${p.votes}">0</span>
                    <span class="text-sm text-gray-500">${percent}%</span>
                </div>
            </div>
        `;
    });

    // Animate bars and vote numbers
    setTimeout(() => {
        document.querySelectorAll('.result-bar').forEach((bar, i) => {
            let percent = sortedParties[i];
            let width = totalVotes ? ((percent.votes / totalVotes) * 100).toFixed(1) : 0;
            bar.style.transition = "width 1.2s cubic-bezier(.4,2,.6,1)";
            bar.style.width = width + "%";
        });
        // Animate vote numbers
        document.querySelectorAll('.count-up').forEach((el, i) => {
            let end = i === 0 ? totalVotes : (i === 1 ? parties.length : sortedParties[i - 2]?.votes || 0);
            animateCountUp(el, end);
        });
    }, 100);

    document.querySelectorAll('.animated-card').forEach((card, i) => {
        setTimeout(() => card.classList.add('visible'), 120 + i * 120);
    });

    // --- PIE CHART ---
    const ctx = document.getElementById('votesPieChart').getContext('2d');
    const partyLabels = parties.map(p => p.name);
    const partyVotes = parties.map(p => p.votes);
    const partyColors = [
        "#6366f1", "#f59e42", "#06b6d4", "#a21caf", "#f43f5e", "#fbbf24", "#10b981", "#3b82f6"
    ];
    if (votesPieChart) votesPieChart.destroy();
    votesPieChart = new Chart(ctx, {
        type: 'pie',
        data: {
            labels: partyLabels,
            datasets: [{
                data: partyVotes,
                backgroundColor: partyColors.slice(0, parties.length),
                borderWidth: 2,
                borderColor: "#fff"
            }]
        },
        options: {
            responsive: false,
            plugins: {
                legend: {
                    display: true,
                    position: 'bottom',
                    labels: {
                        color: "#312e81",
                        font: { size: 14, weight: "bold" }
                    }
                },
                tooltip: {
                    backgroundColor: "#fff",
                    titleColor: "#333",
                    bodyColor: "#666",
                    borderColor: "#ddd",
                    borderWidth: 1,
                    padding: 10,
                    callbacks: {
                        label: function(tooltipItem) {
                            let party = tooltipItem.label;
                            let votes = tooltipItem.raw;
                            let percent = ((votes / totalVotes) * 100).toFixed(1);
                            return [`${party} - ${votes} votes`, `${percent}%`];
                        }
                    }
                }
            },
            elements: {
                arc: {
                    borderWidth: 4,
                    borderColor: "#fff"
                }
            }
        }
    });

    // Progress bar for goal
    const votesGoal = 1000;
    document.getElementById('votesGoalLabel').textContent = `Goal: ${votesGoal}`;
    const percentGoal = Math.min(100, (totalVotes/votesGoal)*100);
    document.getElementById('votesGoalBar').style.width = percentGoal + "%";
}

// Share Results Button
document.getElementById('shareResultsBtn').onclick = function() {
    const url = window.location.href;
    navigator.clipboard.writeText(url);
    alert("Results page link copied! Share it with others.");
};

// Live Clock
function updateClock() {
    const el = document.getElementById('liveClock');
    if (!el) return;
    const now = new Date();
    el.textContent = now.toLocaleString('en-IN', { hour12: true });
}
setInterval(updateClock, 1000);
updateClock();

// Confetti Animation
function confettiBurst() {
    const canvas = document.getElementById('confettiCanvas');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    canvas.style.display = 'block';
    const ctx = canvas.getContext('2d');
    const pieces = Array.from({length: 120}, () => ({
        x: Math.random() * canvas.width,
        y: Math.random() * -canvas.height,
        w: 8 + Math.random() * 8,
        h: 8 + Math.random() * 8,
        color: `hsl(${Math.random()*360},90%,60%)`,
        dy: 2 + Math.random() * 6,
        dx: -2 + Math.random() * 4,
        rot: Math.random() * Math.PI,
        dr: (Math.random() - 0.5) * 0.2
    }));
    let frame = 0;
    function draw() {
        ctx.clearRect(0,0,canvas.width,canvas.height);
        pieces.forEach(p => {
            ctx.save();
            ctx.translate(p.x, p.y);
            ctx.rotate(p.rot);
            ctx.fillStyle = p.color;
            ctx.fillRect(-p.w/2, -p.h/2, p.w, p.h);
            ctx.restore();
            p.x += p.dx;
            p.y += p.dy;
            p.rot += p.dr;
        });
        frame++;
        if (frame < 80) requestAnimationFrame(draw);
        else canvas.style.display = 'none';
    }
    draw();
}

// Initial load
window.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('.animated-card').forEach((card, i) => {
        setTimeout(() => card.classList.add('visible'), 120 + i * 120);
    });
    renderPartyOptions();
    renderResults();
});
</script>
    <canvas id="confettiCanvas" class="fixed inset-0 pointer-events-none z-[9999]" style="display:none"></canvas>
</body>
</html>
